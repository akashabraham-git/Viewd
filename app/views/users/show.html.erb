<div style="max-width: 1000px; margin: 0 auto; padding: 20px; color: #9ab; font-family: sans-serif;">
  
  <%# PROFILE HEADER %>
  <div style="display: flex; justify-content: space-between; margin: 40px 0;">
    <div style="display: flex; gap: 20px; align-items: center;">
      <div style="width: 80px; height: 80px; background: #2c3440; border-radius: 50%; border: 2px solid #fff; overflow: hidden;">
        <% if @user.profile_picture.attached? %>
          <%= image_tag @user.profile_picture, style: "width: 100%; height: 100%; object-fit: cover;" %>
        <% else %>
          <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #456;">ðŸ‘¤</div>
        <% end %>
      </div>

      <div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <h1 style="color: #fff; margin: 0; line-height: 1.1;"><%= @user.name %></h1>
          <% membership = @user.membership %>
          <% if membership&.active? && membership.membership_tier.badge.present? %>
            <%= image_tag "badges/#{membership.membership_tier.badge}.jpg",
              style: "width: 20px; height: 20px; object-fit: contain;" %>
          <% end %>
        </div>

        <p style="font-size: 0.9rem; color: #00e054; margin: 2px 0 5px 0; font-family: monospace;">
          @<%= @user.username %>
        </p>
        <%if @user == @current_user%>
          <% if membership&.membership_tier&.name == "Free" %>
            <%= link_to "GET PRO", memberships_path,
              style: "font-size: 0.7rem; color: #ffd700; text-decoration: none; border: 1px solid #ffd700;
                      padding: 2px 8px; border-radius: 4px; font-weight: bold;" %>
          <% end %>
        <%end%>
      </div>
    </div>

    <%# STATS %>
    <div style="display: flex; gap: 30px; text-align: center; color: #fff;">
      <div><strong><%= @films_count %></strong><br><small style="color:#9ab;">FILMS</small></div>
      <div><strong><%= @this_year_count %></strong><br><small style="color:#9ab;">THIS YEAR</small></div>
      <%= link_to connections_path(user_id: @user.id, type: 'following'), style:"color:inherit;text-decoration:none;" do %>
        <div><strong><%= @user.following.count %></strong><br><small style="color:#9ab;">FOLLOWING</small></div>
      <% end %>
      <%= link_to connections_path(user_id: @user.id, type: 'followers'), style:"color:inherit;text-decoration:none;" do %>
        <div><strong><%= @user.followers.count %></strong><br><small style="color:#9ab;">FOLLOWERS</small></div>
      <% end %>
    </div>
  </div>

  <%# ACTION BUTTONS (Follow or Edit) %> 
  <div style="display: flex; flex-direction: column; gap: 10px; align-items: flex-end;"> 
    <% if @user == @current_user %> 
      <%= link_to "EDIT PROFILE", edit_user_path(@user), style: "background: #2c3440; color: #fff; text-decoration: none; padding: 6px 12px; border-radius: 3px; font-size: 0.7rem; font-weight: bold; border: 1px solid #456;" %> 
    <% else %> 
      <% if @current_user.following?(@user) %> 
        <%= button_to "Unfollow", connection_path(@user), method: :delete, class: "btn-unfollow", style: "background: #e14f4fff; color: #000; border: none; padding: 6px 14px; border-radius: 3px; font-weight: bold; cursor: pointer;" %> 
      <% else %> 
        <%= button_to "Follow", connections_path(following_id: @user.id), method: :post, class: "btn-follow", style: "background: #00e054; color: #000; border: none; padding: 6px 14px; border-radius: 3px; font-weight: bold; cursor: pointer;" %> 
      <% end %> 
    <% end %> 
  </div>

  <%# NAVBAR %>
  <div style="display:flex;gap:25px;border-bottom:1px solid #2c3440;margin-bottom:30px;
              padding-bottom:10px;font-size:0.8rem;font-weight:bold;text-transform:uppercase;">
    <%= link_to "Films", library_user_path(@user), style:"color:#fff;text-decoration:none;" %>
    <%= link_to "Watchlist", watchlist_user_path(@user), style:"color:#fff;text-decoration:none;" %>
    <%= link_to "Likes", user_likes_path(@user), style:"color:#fff;text-decoration:none;" %>
    <%= link_to "Reviews", user_reviews_path(@user), style:"color:#fff;text-decoration:none;" %>
  </div>

  <div style="display:flex;gap:40px;">
    <div style="flex:2;">
      <% if @user.bio.present? %>
        <p style="margin-bottom:30px;"><%= @user.bio %></p>
      <% end %>

      <%# FAVORITES %>
      <div style="display:flex;justify-content:space-between;border-bottom:1px solid #456;">
        <h4 style="color:#fff;font-size:0.7rem;">FAVORITE FILMS</h4>
        <%= link_to "VIEW ALL", user_likes_path(@user),
          style:"color:#00e054;font-size:0.7rem;text-decoration:none;" %>
      </div>

      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:40px;">
        <% @favorite_movies.each do |movie| %>
          <%= link_to movie_path(movie) do %>
      <%= image_tag movie.poster_url,
              style:"width:100%;border-radius:4px;border:1px solid #2c3440;" %>
          <% end %>
        <% end %>
      </div>

      <%# RECENT ACTIVITY %>
      <h4 style="display:flex;justify-content:space-between;border-bottom:1px solid #456;
                 color:#fff;font-size:0.7rem;">
        RECENT ACTIVITY
        <%= link_to "VIEW ALL", library_user_path(@user),
          style:"color:#00e054;text-decoration:none;" %>
      </h4>

      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;">
        <% @recent_activity.each do |entry| %>
          <%= link_to movie_path(entry.movie) do %>
            <%= image_tag entry.movie.poster_url,
              style:"width:100%;border-radius:3px;border:1px solid #2c3440;" %>
          <% end %>
        <% end %>
      </div>
    </div>
  
    <div style="flex: 1; display: flex; flex-direction: column;">

      <%# WATCHLIST %>
      <div>
        <h4 style="display:flex;justify-content:space-between;border-bottom:1px solid #456;
                  color:#fff;font-size:0.7rem;">
          WATCHLIST
          <%= link_to "VIEW ALL", watchlist_user_path(@user),
            style:"color:#00e054;text-decoration:none;" %>
        </h4>

        <div style="display:flex;position:relative;height:120px;margin-left:10px;">
          <% @watchlist.each_with_index do |entry,i| %>
            <%= link_to movie_path(entry.movie) do %>
              <%= image_tag entry.movie.poster_url,
                style:"width:80px;height:110px;border:1px solid #000;
                      position:absolute;left:#{i*22}px;z-index:#{10-i};
                      box-shadow:-2px 0 5px rgba(0,0,0,0.5);
                      border-radius:3px;" %>
            <% end %>
          <% end %>
        </div>
      </div>

      <%# YOUR REVIEWS %>
      <div style="margin-top: 40px;">
        <h4 style="border-bottom: 1px solid #456;
                  color: #fff;
                  font-size: 0.7rem;
                  padding-bottom: 5px;
                  margin-bottom: 15px;">
          REVIEWS
        </h4>

        <% if @top_reviews.any? %>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <% @top_reviews.each do |review| %>
              <%= link_to review_path(review), style: "text-decoration: none;" do %>
                <div style="display: flex;
                            gap: 10px;
                            background: #1a2129;
                            padding: 8px;
                            border-radius: 4px;
                            border: 1px solid #2c3440;">

                  <%= image_tag review.movie.poster_url,
                    style:"width:35px;height:50px;object-fit:cover;border-radius:2px;" %>

                  <div style="flex:1;">
                    <p style="color:#fff;font-size:0.75rem;margin:0 0 4px 0;line-height:1.2;">
                      <%= review.movie.title %>
                    </p>

                    <p style="color:#9ab;font-size:0.7rem;margin:0;line-height:1.3;
                              overflow:hidden;display:-webkit-box;
                              -webkit-line-clamp:2;-webkit-box-orient:vertical;">
                      <%= review.content %>
                    </p>

                    <p style="color:#456;font-size:0.65rem;margin-top:4px;">
                      â™¥ <%= review.likes.count %>
                    </p>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        <% else %>
          <p style="color:#456;font-size:0.7rem;">No reviews yet.</p>
        <% end %>
      </div>

    </div>

  </div>
</div>
